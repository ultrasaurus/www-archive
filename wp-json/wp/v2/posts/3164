{"id":3164,"date":"2011-05-08T13:41:35","date_gmt":"2011-05-08T21:41:35","guid":{"rendered":"https:\/\/www.ultrasaurus.com\/?p=3164"},"modified":"2011-05-08T13:41:35","modified_gmt":"2011-05-08T21:41:35","slug":"what-exactly-does-rake-spec-do","status":"publish","type":"post","link":"https:\/\/www.ultrasaurus.com\/2011\/05\/what-exactly-does-rake-spec-do\/","title":{"rendered":"what exactly does rake spec do?"},"content":{"rendered":"<p>$ rake spec<br \/>\n(in \/Users\/sarah\/src\/..\/my_app)<br \/>\nYou have 1 pending migrations:<br \/>\n  20110416135407 CreateCourses<\/p>\n<p>The rake spec command reminds us that we need to run our migration before running<br \/>\nour tests. In fact, it does a whole lot more than that. There are a whole bunch of best practices rolled in that one<br \/>\ncommand. To see exactly what is going on, we can run rake spec with the &#8211;trace<br \/>\noption:<\/p>\n<p><code><br \/>\n$ rake spec --trace<br \/>\n(in \/Users\/sarah\/src\/tfr\/svn\/Book\/code\/class_app_new_source)<br \/>\n** Invoke spec (first_time)<br \/>\n** Invoke db:test:prepare (first_time)<br \/>\n** Invoke db:abort_if_pending_migrations (first_time)<br \/>\n** Invoke environment (first_time)<br \/>\n** Execute environment<br \/>\n** Execute db:abort_if_pending_migrations<br \/>\n** Execute db:test:prepare<br \/>\n** Invoke db:test:load (first_time)<br \/>\n** Invoke db:test:purge (first_time)<br \/>\n** Invoke environment<br \/>\n** Execute db:test:purge<br \/>\n** Execute db:test:load<br \/>\n** Invoke db:schema:load (first_time)<br \/>\n** Invoke environment<br \/>\n** Execute db:schema:load<br \/>\n** Execute spec<br \/>\n<\/code><\/p>\n<p>When it says invoke it is calling a particular rake task, but then it will call its dependencies. To really see what is happening in what order, check out the execute commands.  The commands db:test:prepare and db:test:load don\u2019t do much themselves, aside from setting up the environment and executing another task or two.  We can see from the output that rake is actually executing the following steps:<\/p>\n<ol>\n<li>\n<p>\nDon\u2019t run the specs if there are pending migrations in the development database. (db:abort_if_pending_migrations)\n<\/p>\n<\/li>\n<li>\n<p>\nDrop the test database (db:test:purge)\n<\/p>\n<\/li>\n<li>\n<p>\nLoad the schema into the test database (db:schema:load in environment \u201ctest\u201d)\n<\/p>\n<\/li>\n<\/ol>\n<p>These steps make sure that we are always testing in a clean environment, so we know exactly what we\u2019re testing when we run our specs.<\/p>\n<p>The code that makes this happen in Rails 3, can now be found in <a href=\"https:\/\/github.com\/rails\/rails\/blob\/master\/activerecord\/lib\/active_record\/railties\/databases.rake#L455\">railties<\/a>.  (Thanks to <a href=\"http:\/\/twitter.com\/pixeltrix\">@pixeltrix<\/a> for pointing me to it.)\/62206174505873408<\/p>\n","protected":false},"excerpt":{"rendered":"<p>$ rake spec (in \/Users\/sarah\/src\/..\/my_app) You have 1 pending migrations: 20110416135407 CreateCourses The rake spec command reminds us that we need to run our migration before running our tests. In fact, it does a whole lot more than that. There are a whole bunch of best practices rolled in that one command. To see exactly&hellip; <a href=\"https:\/\/www.ultrasaurus.com\/2011\/05\/what-exactly-does-rake-spec-do\/\">Continue reading <span class=\"meta-nav\">&rarr;<\/span><\/a><\/p>\n","protected":false},"author":84,"featured_media":0,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":[],"categories":[2],"tags":[],"_links":{"self":[{"href":"https:\/\/www.ultrasaurus.com\/wp-json\/wp\/v2\/posts\/3164"}],"collection":[{"href":"https:\/\/www.ultrasaurus.com\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/www.ultrasaurus.com\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/www.ultrasaurus.com\/wp-json\/wp\/v2\/users\/84"}],"replies":[{"embeddable":true,"href":"https:\/\/www.ultrasaurus.com\/wp-json\/wp\/v2\/comments?post=3164"}],"version-history":[{"count":0,"href":"https:\/\/www.ultrasaurus.com\/wp-json\/wp\/v2\/posts\/3164\/revisions"}],"wp:attachment":[{"href":"https:\/\/www.ultrasaurus.com\/wp-json\/wp\/v2\/media?parent=3164"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/www.ultrasaurus.com\/wp-json\/wp\/v2\/categories?post=3164"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/www.ultrasaurus.com\/wp-json\/wp\/v2\/tags?post=3164"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}