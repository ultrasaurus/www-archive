{"id":574,"date":"2009-01-11T07:24:46","date_gmt":"2009-01-11T15:24:46","guid":{"rendered":"https:\/\/www.ultrasaurus.com\/?p=574"},"modified":"2009-01-11T07:24:46","modified_gmt":"2009-01-11T15:24:46","slug":"generating-an-htaccess-file-for-wordpress-migration","status":"publish","type":"post","link":"https:\/\/www.ultrasaurus.com\/2009\/01\/generating-an-htaccess-file-for-wordpress-migration\/","title":{"rendered":"generating an .htaccess file for wordpress migration"},"content":{"rendered":"<p>So, I&#8217;ve been working to migrate my ultrasaurus weblog from Movable Type to WordPress (this one will come later).  Since all the links were changing anyhow, I decided to move from ugly numbered permalinks to pretty links based on the title of the post.  I only had a few hundred posts, but enough so I didn&#8217;t want to be doing it by hand.  Since I&#8217;m learning Ruby and infatuated with it at the moment, I wrote a Ruby script to generate the .htaccess directives.<\/p>\n<p>In case this would be helpful to anyone else, here&#8217;s the code:<\/p>\n<p>[sourcecode language=&#8217;ruby&#8217;]<br \/>\nrequire &#8216;date&#8217;<br \/>\nrequire &#8216;find&#8217;<\/p>\n<p>Find.find(&#8216;.\/archives\/&#8217;) do |fname|<br \/>\n# puts fname<br \/>\ndate_string = &#8220;&#8221;<br \/>\ntitle = &#8220;&#8221;<br \/>\nnext if File.directory?(fname)<br \/>\nFile.open(fname, &#8220;r&#8221;) do |f|<br \/>\n    f.each_line do |line|<br \/>\n        if m =  line.match(&#8220;(<\/p>\n<h2 class=\"date\">)(.*)(<\/h2>\n<p>)&#8221;) then<br \/>\n            date_string = m.captures[1]<br \/>\n        elsif m = line.match(&#8220;(<\/p>\n<h3 class=\"title\">)(.*)(&lt;\/h3)&quot;) then<br \/>\n            title = m.captures[1].downcase<br \/>\n        end<br \/>\n    end<br \/>\nend<\/p>\n<p># for some reason my mt archives include some old drafts with no titles<br \/>\nnext if title == &quot;&quot;<\/p>\n<p>oldfilename = File.basename(fname)<\/p>\n<p># 1) remove chars that I think wordpress removes<br \/>\n# 2) change spaces to dashes<br \/>\n# 3) handle this case to avoid &#8212;<br \/>\n#       Emmy Award for Outstanding Lead Actress &#8211; Miniseries or Movie<br \/>\n#    also avoid &#8212; which I saw in my data, but not sure why it was there<br \/>\n# 4) remove trailing dash if there is one<br \/>\n#  Thank you ruby-talk http:\/\/www.ruby-forum.com\/topic\/167299<br \/>\ntitle = title.gsub(\/[(,?!&#039;&quot;:.+=\/)]\/, &#039;&#039;).gsub(&#039; &#039;, &#039;-&#039;).gsub(&#039;&#8211;&#039;,&#039;-&#039;).gsub(\/-$\/, &#039;&#039;)<\/p>\n<p># get the new path to the entry, like &quot;\/2003\/03\/brand-new-weblog\/&quot;<br \/>\ndate = Date.parse(date_string)<br \/>\nnewpath = sprintf(&quot;%d\/%02d\/%s\/&quot;, date.year.to_s, date.month.to_s, title);<\/p>\n<p># we want something like this:<br \/>\n# redirect 301 \/old\/old.htm http:\/\/www.you.com\/new.htm<\/p>\n<p>output = &quot;redirect 301 \/sarahblog\/archives\/&quot; + oldfilename + &quot; https:\/\/www.ultrasaurus.com\/sarahblog\/&quot; + newpath<br \/>\nputs output<\/p>\n<p>end # loop thru files in directory<br \/>\n[\/sourcecode] <\/p>\n","protected":false},"excerpt":{"rendered":"<p>So, I&#8217;ve been working to migrate my ultrasaurus weblog from Movable Type to WordPress (this one will come later). Since all the links were changing anyhow, I decided to move from ugly numbered permalinks to pretty links based on the title of the post. I only had a few hundred posts, but enough so I&hellip; <a href=\"https:\/\/www.ultrasaurus.com\/2009\/01\/generating-an-htaccess-file-for-wordpress-migration\/\">Continue reading <span class=\"meta-nav\">&rarr;<\/span><\/a><\/p>\n","protected":false},"author":84,"featured_media":0,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":[],"categories":[2],"tags":[],"_links":{"self":[{"href":"https:\/\/www.ultrasaurus.com\/wp-json\/wp\/v2\/posts\/574"}],"collection":[{"href":"https:\/\/www.ultrasaurus.com\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/www.ultrasaurus.com\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/www.ultrasaurus.com\/wp-json\/wp\/v2\/users\/84"}],"replies":[{"embeddable":true,"href":"https:\/\/www.ultrasaurus.com\/wp-json\/wp\/v2\/comments?post=574"}],"version-history":[{"count":0,"href":"https:\/\/www.ultrasaurus.com\/wp-json\/wp\/v2\/posts\/574\/revisions"}],"wp:attachment":[{"href":"https:\/\/www.ultrasaurus.com\/wp-json\/wp\/v2\/media?parent=574"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/www.ultrasaurus.com\/wp-json\/wp\/v2\/categories?post=574"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/www.ultrasaurus.com\/wp-json\/wp\/v2\/tags?post=574"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}