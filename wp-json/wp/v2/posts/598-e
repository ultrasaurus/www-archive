{"id":598,"date":"2008-12-14T11:22:46","date_gmt":"2008-12-14T19:22:46","guid":{"rendered":"https:\/\/www.ultrasaurus.com\/sarahblog\/2008\/12\/getting-started-with-rails-2-day-2\/"},"modified":"2008-12-14T11:22:46","modified_gmt":"2008-12-14T19:22:46","slug":"getting-started-with-rails-2-day-2","status":"publish","type":"post","link":"https:\/\/www.ultrasaurus.com\/2008\/12\/getting-started-with-rails-2-day-2\/","title":{"rendered":"getting started with rails 2 &#8211; day 2"},"content":{"rendered":"<p>In <a href=\"https:\/\/www.ultrasaurus.com\/code\/2008\/12\/getting-started-with-rails.html\">Day 1<\/a> with Rails, we built a simple application that let us manage a list of categories using the powerful generate scaffold script.  Today, we&#8217;ll look under the hood and learn about the code that was created for us, so that we can modify the application to do just what we want (or, rather, what the tutorial <a href=\"http:\/\/rails.homelinux.org\/\">Four Days on Rails<\/a> tutorial did, as I continue to update that tutorial for Rails 2.)<\/p>\n<p>You&#8217;ll get the most out of Day 2, if you already know Ruby or you first read chapters 0-3 of the <a href=\"https:\/\/www.ultrasaurus.com\/code\/2008\/12\/great-ruby-book.html\">humble little Ruby book<\/a> or some other introduction to the language.  Or, of course, you can just wing it.<\/p>\n<p>You also should know about the MVC (Model View Controller) design pattern.  Although if you don&#8217;t know MVC already, you&#8217;ll get the hang of it soon, at least from the Rails perspective.  The Getting Started Guide has a <a href=\"http:\/\/guides.rubyonrails.org\/getting_started_with_rails.html#_the_mvc_architecture\">nice intro<\/a> to MVC and elaborates on how Rails applies this venerated pattern:<\/p>\n<blockquote>\n<p>2.1.1. <strong>Models<\/strong>  A model represents the information (data) of the application and the rules to manipulate that data. In the case of Rails, models are primarily used for managing the rules of interaction with a corresponding database table. In most cases, one table in your database will correspond to one model in your application. The bulk of your application&#8217;s business logic will be concentrated in the models.<\/p>\n<p>2.1.2. <strong>Views<\/strong> Views represent the user interface of your application. In Rails, views are often HTML files with embedded Ruby code that performs tasks related solely to the presentation of the data. Views handle the job of providing data to the web browser or other tool that is used to make requests from your application.<\/p>\n<p>2.1.3. <strong>Controllers<\/strong> Controllers provide the &#8220;glue&#8221; between models and views. In Rails, controllers are responsible for processing the incoming requests from the web browser, interrogating the models for data, and passing that data on to the views for presentation.<\/p>\n<\/blockquote>\n<p>In today&#8217;s tutorial, we will learn about:<\/p>\n<ol>\n<li><a href=\"#model\">The Model<\/a>\n<ul>\n<li><a href=\"#validation\">Validation<\/a><\/li>\n<\/ul>\n<\/li>\n<li><a href=\"#controller\">The Controller<\/a><\/li>\n<li><a href=\"#views\">Views<\/a>\n<ul>\n<li><a href=\"#layout\">Layout<\/a><\/li>\n<li> <a href=\"#templates\">Templates<\/a><\/li>\n<\/ul>\n<\/li>\n<li><a href=\"#edit\">Tailoring the Generated Scaffold Code<\/a>\n<ul>\n<li><a href=\"#edit-controller\">Modifying the Controller<\/a><\/li>\n<li> <a href=\"#vars\">Sharing Variables<\/a><\/li>\n<li> <a href=\"#partial\">Partial Templates<\/a><\/li>\n<\/ul>\n<\/li>\n<li><a href=\"#review\">Review what we learned<\/a><\/li>\n<\/ol>\n<p>h1 {font-size: 150%}<br \/>\nh1,h2 {font-style: bold}<br \/>\nimg<br \/>\n{<br \/>\nborder:2px solid silver;<br \/>\nmargin:0px 0px 15px 20px;<br \/>\n}<br \/>\nblockquote, pre.code {<br \/>\nborder: solid 1px #aaa;<br \/>\npadding: 6px;<br \/>\nbackground-color: #eee;<br \/>\ncolor: inherit;<br \/>\noverflow:auto;<br \/>\nmargin: 10px 0px;<br \/>\n}<\/p>\n<p>&nbsp;<\/p>\n<hr \/>\n<p>&nbsp;<\/p>\n<p>h1 {font-size: 150%}<br \/>\nh1,h2 {font-style: bold}<br \/>\nimg<br \/>\n{<br \/>\nborder:2px solid silver;<br \/>\nmargin:0px 0px 15px 20px;<br \/>\n}<\/p>\n<p><a name=\"model\"><\/p>\n<h1>The Model<\/h1>\n<p><\/a><\/p>\n<p>The definition of the model is in one of the files generated by scaffold:<\/p>\n<pre><strong>app\/models\/category.rb<\/strong><\/pre>\n<blockquote>\n<pre>\nclass Category &lt; ActiveRecord::Base\nend\n<\/pre>\n<\/blockquote>\n<p>This is a Ruby file that declare a class named Category that inherits from class ActiveRecord::Base. To define a class in Ruby, you place the class keyword at the beginning of a line, followed by the class name and a &lt; and the class it inherits from.<\/p>\n<p>Active Record is one of the &#8220;gems&#8221; installed with Rails. Looking in the <a href=\"http:\/\/api.rubyonrails.org\/\">Ruby on Rails api documentation<\/a> for ActiveRecord::Base in the Classes section shows all of the methods, attributes, exceptions and other parts available in class ActiveRecord::Base.<\/p>\n<p>An instance of the class Category could be called anything but the Rails convention is to use a variable named category or @category. The :: symbol is the Ruby scope operator. In ActiveRecord::Base it means that you are referring to the Base of ActiveRecord and not some other base.  <\/p>\n<p>note: I&#8217;ve adapted this nice explanation from <a href=\"http:\/\/fairleads.blogspot.com\/2007\/12\/rails-20-and-scaffolding-step-by-step.html\">Fairleads<\/a> along with language note from the <a href=\"https:\/\/www.ultrasaurus.com\/code\/2008\/12\/great-ruby-book.html\">humble little ruby book<\/a>)<\/p>\n<p>We will customize our Model by adding code here.<\/p>\n<p><a name=\"validation\"><\/p>\n<h2>Validation<\/h2>\n<p><\/a><\/p>\n<p>Let&#8217;s say we want to make it so that each category appears once and only once in the category list.  If you try that now, you&#8217;ll notice that the application allows a duplicate entry.  Go ahead and delete the duplicate. We&#8217;ll make sure it isn&#8217;t allowed in the future, by adding validation to the model.  <\/p>\n<p>Rails gives you a lot of error handling for free (almost). To demonstrate this, add some validation rules to the  empty category model: <\/p>\n<p><strong><\/p>\n<pre>app\/models\/category.rb<\/pre>\n<p><\/strong><\/p>\n<blockquote>\n<pre>\nclass Category  1..20\nvalidates_uniqueness_of :title, :message =&gt; \"already exists\"\nend\n<\/pre>\n<\/blockquote>\n<p>These entries will give automatic checking that: <\/p>\n<ul>\n<li><strong>validates_length_of<\/strong>: the field is not blank and not too long <\/li>\n<li><strong>validates_uniqueness_of<\/strong>: duplicate values are trapped. I don&#8217;t like the default Rails error message &#8211; &#8216;xxx has already been taken&#8217; &#8211; so I provide my own. Note: This is a general feature of Rails &#8211; try the defaults first; if you don&#8217;t like anything, overwrite it. <\/li>\n<\/ul>\n<p>Documentation: <a href=\"http:\/\/api.rubyonrails.org\/classes\/ActiveRecord\/Validations\/ClassMethods.html\">ActiveRecord::Validations::ClassMethods<\/a><\/p>\n<p>To try this out, now try to insert a duplicate record. This time, Rails will you prevent you from creating a duplicate record (see below). The style is a bit in your face &#8212; it&#8217;s not the most subtle of user interfaces. However, what do you expect for free? <\/p>\n<p><img src=\"http:\/\/farm4.static.flickr.com\/3115\/3105384025_b9c12b7cc5.jpg?v=0\" \/><\/p>\n<p><a name=\"controller\"><\/p>\n<h1>The Controller<\/h1>\n<p><\/a><\/p>\n<p>Let&#8217;s look at the code behind the controller. The controller is where the programming logic for the application<br \/>\nlies. It interacts with the user using views, and with the database through models. You should be able to read the<br \/>\ncontroller and see how the application hangs together. <\/p>\n<p>Some methods of the controller along with the class definition produced by the scaffold script are listed below: <\/p>\n<p><strong>app\/controllers\/categories_controller.rb<\/strong><\/p>\n<blockquote>\n<pre>\nclass CategoriesController  @categories }\n   end\nend\n\n# GET \/categories\/1\n# GET \/categories\/1.xml\ndef show\n   @category = Category.find(params[:id])\n\n   respond_to do |format|\n      format.html # show.html.erb\n      format.xml  { render :xml =&gt; @category }\n   end\nend\n:\n:\n# DELETE \/categories\/1\n# DELETE \/categories\/1.xml\ndef destroy\n   @category = Category.find(params[:id])\n   @category.destroy\n\n   respond_to do |format|\n      format.html { redirect_to(categories_url) }\n      format.xml  { head :ok }\n   end\nend\nend\n<\/pre>\n<\/blockquote>\n<p>Note that just like the model, the controller is simply a ruby class file.  Each method in the class defines an action.  Actions, by default, render a template in the app\/views directory corresponding to the name of the controller and action after executing code in the action.  For example, the index action in our Categories controller renders a list of categories; however, note that unlike index, the destroy action will not render a template. After performing its main purpose (calling destroy on the category object that the user selected), it initiates a redirect instead.<\/p>\n<p>Note: there is quite a bit of Ruby magic going on in the generated controller file with exactly how the respond_to block works.  Perhaps I&#8217;ll dive into that once I&#8217;ve got the basics down.<\/p>\n<p><a name=\"views\"><\/p>\n<h1>Views<\/h1>\n<p><\/a><\/p>\n<p>Views are where the user interface is defined. Rails can render the final HTML page presented to the user from three components: <\/p>\n<ul>\n<li><strong>Layout<\/strong>. A layout provides common code used by all actions, typically the start and end of the HTML sent to the<br \/>\nbrowser.<\/li>\n<li><strong>Template<\/strong> A Template provides code specific to an action, e.g. &#8216;List&#8217; code, &#8216;Edit&#8217; code, etc.<\/li>\n<li><strong>Partial<\/strong>  A Partial provides common code which can be used in used in multiple actions.<\/li>\n<\/ul>\n<p>If you look at the view files generated by the scaffold command, you will see that they are .erb files.  I&#8217;m not sure what &#8216;erb&#8217; stands for, but they <a href=\"http:\/\/ryandaigle.com\/articles\/2007\/2\/21\/what-s-new-in-edge-rails-rhtml-and-rxml-to-die-a-slow-and-painful-death\">have replaced .rhtml files<\/a> in previous versions of Rails.  These files are a mix of html markup with snippets of ruby code in them. <\/p>\n<ul>\n<li>app\/views\/\n<ul>\n<li>categories\/\n<ul>\n<li>index.html.erb<\/li>\n<li>show.html.erb<\/li>\n<li>new.html.erb<\/li>\n<li>edit.html.erb<\/li>\n<\/ul>\n<\/li>\n<li>layouts\/<\/li>\n<ul>\n<li>categories.html.erb<\/li>\n<\/ul>\n<\/li>\n<\/ul>\n<\/li>\n<\/ul>\n<p><a name=\"layout\"><\/p>\n<h2>Layout<\/h2>\n<p><\/a><\/p>\n<p>Rails Naming conventions: if there is a template in appviewslayouts with the same name as the current controller then it will be automatically set as that controller&#8217;s layout unless explicitly told otherwise.<\/p>\n<p><code><br \/>\n<strong>apps\/layouts\/categories.html.erb<\/strong><\/p>\n<blockquote>\n<pre>\n&lt;!DOCTYPE html PUBLIC &quot;-\/\/W3C\/\/DTD XHTML 1.0 Transitional\/\/EN&quot;\n&quot;http:\/\/www.w3.org\/TR\/xhtml1\/DTD\/xhtml1-transitional.dtd&quot;&gt;<br \/>\n<br \/>\n&lt;html xmlns=&quot;http:\/\/www.w3.org\/1999\/xhtml&quot; xml:lang=&quot;en&quot; lang=&quot;en&quot;&gt;<br \/>\n&lt;head&gt;<br \/>\n&nbsp;&nbsp;&nbsp;&lt;meta http-equiv=&quot;content-type&quot; content=&quot;text\/html;charset=UTF-8&quot; \/&gt;<br \/>\n&nbsp;&nbsp;&nbsp;&lt;title&gt;Categories: &lt;%= controller<strong>.action_name<\/strong> %&gt;&lt;\/title&gt;<br \/>\n&nbsp;&nbsp;&nbsp;&lt;%= <strong>stylesheet_link_tag<\/strong> 'scaffold' %&gt;<br \/>\n&lt;\/head&gt;<br \/>\n&lt;body&gt;<br \/>\n<br \/>\n&lt;p style=&quot;color: green&quot;&gt;&lt;%= <strong>flash<\/strong>[:notice] %&gt;&lt;\/p&gt;<br \/>\n<br \/>\n&lt;%= <strong>yield<\/strong>  %&gt;<br \/>\n<br \/>\n&lt;\/body&gt;<br \/>\n&lt;\/html&gt;<br \/>\n<\/pre>\n<\/blockquote>\n<p><\/code><\/p>\n<p>This is mostly HTML, plus a few bits of Ruby code embedded within <code><\/code> tags. This layout will be called by<br \/>\nthe rendering process regardless of the action being run. It contains the standard HTML tags &#8211; the<br \/>\n<code>&lt;html&gt;&lt;head&gt;...&lt;\/head&gt;&lt;body&gt;...&lt;\/body&gt;&lt;\/html&gt;<\/code> that will appear on every page.<\/p>\n<p>The Ruby bits in bold are translated into HTML during the Rails rendering process as follows:<\/p>\n<ul>\n<li><strong>action_name<\/strong> is an ActionController method which returns the name of the action the controller is processing (e.g. &#8216;Edit&#8217;) &#8211; this puts an appropriate title on the page, depending on the action being run.<br \/>Documentation: ActionController::Base<\/li>\n<li><strong>stylesheet_link_tag<\/strong> is a Rails helper &#8211; a lazy way of generating code. There are a lot of these &#8216;helpers&#8217; within Rails. This one simply generates the following HTML: <code>&lt;link href=&quot;\/stylesheets\/scaffold.css&quot; media=&quot;screen&quot; rel=&quot;Stylesheet&quot; type=&quot;text\/css&quot; \/&gt;<\/code><br \/>Documentation: ActionView::Helpers::AssetTagHelper<\/li>\n<li><strong>flash<\/strong> Rails provides a technique for passing &#8216;flash&#8217; messages back to the user &#8211; e.g. an &#8216;Update Successful&#8217; message which displays on the next screen and then disappears. These can be picked up easily when included in the layout (adding it to the Layout means it will appear on any screen).  (The flash message will, of course, only appear when the previous screen sends such a message.<br \/>Documentation: ActionController::Flash<\/li>\n<li><strong>yield<\/strong> is the key to what happens next. It allows a single standard layout to have dynamic content inserted at rendering time based on the action being performed (e.g. &#8216;edit&#8217;, &#8216;new&#8217;, &#8216;list&#8217;). In Ruby the yield command will execute a block of code that is passed as an argument.  In this case, the code will insert dynamic content from a Template with the same name &#8211; see below.<br \/>\nDocumentation:  see Ruby language docs. <\/li>\n<\/ul>\n<p><a name=\"templates\"><\/p>\n<h2>Templates<\/h2>\n<p><\/a><\/p>\n<p>Rails naming convention: templates are held in appviews&#8217;controller&#8221;action&#8217;.erb.html. The basic list action is perhaps easiest to understand.  This is the default action for the controller and is therefore the &#8216;index&#8217; template<\/p>\n<p><code><br \/>\n<strong>app\/views\/categories\/index.erb.html<\/strong><\/p>\n<blockquote><p>\n&lt;h1&gt;Listing categories&lt;\/h1&gt;<\/p>\n<p>&lt;table&gt;<br \/>\n<br \/>&nbsp;&nbsp;&nbsp;&lt;tr&gt;<br \/>\n<br \/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;th&gt;Title&lt;\/th&gt;<br \/>\n<br \/>&nbsp;&nbsp;&nbsp;&lt;\/tr&gt;<\/p>\n<p>&lt;% <strong>for category in @categories<\/strong> %&gt;<br \/>\n<br \/>&nbsp;&nbsp;&nbsp;&lt;tr&gt;<br \/>\n<br \/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;&lt;%=<strong>h category.title<\/strong> %&gt;&lt;\/td&gt;<br \/>\n<br \/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;&lt;%= <strong>link_to<\/strong> 'Show', category %&gt;&lt;\/td&gt;<br \/>\n<br \/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;&lt;%= <strong>link_to<\/strong> 'Edit', edit_category_path(category) %&gt;&lt;\/td&gt;<br \/>\n<br \/>&nbsp;&nbsp;&nbsp;&lt;td&gt;&lt;%= <strong>link_to<\/strong> 'Destroy', category, :<strong>confirm<\/strong> =&gt; 'Are you sure?', :method =&gt; :delete %&gt;&lt;\/td&gt;<br \/>\n<br \/>  &lt;\/tr&gt;<br \/>\n<br \/>&lt;% <strong>end<\/strong> %&gt;<br \/>\n<br \/>&lt;\/table&gt;<\/p>\n<p>&lt;br \/&gt;<\/p>\n<p>&lt;%= <strong>link_to<\/strong> 'New category', new_category_path %&gt;\n<\/p><\/blockquote>\n<p><\/code><\/p>\n<p>Below are some notes about the more interesting bits of code highlighted (bold) above<\/p>\n<ul>\n<li><strong>for &#8230; in &#8230; end<\/strong> This is some simple Ruby code to loop through the items in the array @categories.  The enclosed table rows are rendered for each category in the list.<\/li>\n<li><strong>h<\/strong> automatically &#8216;escapes&#8217; HTML code. One of the problems with allowing users to input data which is then displayed on the screen is that they could accidentally (or maliciously) type in code which could break the system when it was displayed. For example, think what would happen if a user typed in <code>&lt;\/table&gt;<\/code> as a Category. To guard against this, it is good practice to &#8216;HTML escape&#8217; any data which has been provided by users. This means that e.g. <code>&lt;\/table&gt;<\/code> is rendered as &amp;lt;\/table&amp;gt; which is harmless. Rails makes this really simple &#8211; just add an &#8216;h&#8217; as shown<\/li>\n<li><strong>confirm<\/strong> is a useful optional parameter for the link_to helper &#8212; it generates a Javascript pop-up box which forces the user to confirm the Destroy before actioning the link.<\/li>\n<li><strong>link_to<\/strong> simply creates a link &#8212; the most fundamental part of HTML&#8230; &lt;a href=&quot;\/categories\/2&quot;&gt;Show&lt;\/a&gt; <br \/> Documentation: ActionView::Helpers::UrlHelper<\/li>\n<\/ul>\n<p>The &#8216;new&#8217; action template created by the scaffold script is given below:<\/p>\n<p><code><strong>app\/views\/categories\/new.erb.html<\/strong><\/p>\n<blockquote><p>\n&lt;h1&gt;New&nbsp;category&lt;\/h1&gt;<\/p>\n<p>&lt;%&nbsp;<strong>form_for<\/strong>(@category)&nbsp;<strong>do<\/strong>&nbsp;|f|&nbsp;%&gt;<br \/>\n<br \/>&nbsp;&nbsp;&lt;%=&nbsp;<strong>f.error_messages<\/strong>&nbsp;%&gt;<\/p>\n<p>&nbsp;&nbsp;&lt;p&gt;<br \/>\n<br \/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;%=&nbsp;<strong>f.label<\/strong>&nbsp;:title&nbsp;%&gt;&lt;br&nbsp;\/&gt;<br \/>\n<br \/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;%=&nbsp;<strong>f.text_field<\/strong>&nbsp;:title&nbsp;%&gt;<br \/>\n<br \/>&nbsp;&nbsp;&lt;\/p&gt;<br \/>\n<br \/>&nbsp;&nbsp;&lt;p&gt;<br \/>\n<br \/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;%=&nbsp;<strong>f.submit<\/strong>&nbsp;&quot;Create&quot;&nbsp;%&gt;<br \/>\n<br \/>&nbsp;&nbsp;&lt;\/p&gt;<br \/>\n<br \/>&lt;%&nbsp;end&nbsp;%&gt;<\/p>\n<p>&lt;%=&nbsp;link_to&nbsp;'Back',&nbsp;categories_path&nbsp;%&gt;\n<\/p><\/blockquote>\n<p><code><\/p>\n<p><strong>form_for<\/strong> is part of the Rails FormHelper class.  The 'new' form is defined with the block of Ruby code between do and end. Form helpers are designed to make working with models much easier compared to using just standard HTML elements by providing a set of methods for creating forms based on your models. This helper generates the HTML for forms, providing a method for each sort of input (e.g., text, password, select, and so on). When the form is submitted, the form inputs will be bundled into the params object and passed back to the controller. The form that is generated can be seen here: <\/p>\n<p><code><\/p>\n<blockquote><p>\n&lt;form&nbsp;action=&quot;\/categories&quot;&nbsp;class=&quot;new_category&quot;&nbsp;id=&quot;new_category&quot;&nbsp;method=&quot;post&quot;&gt;&lt;div&nbsp;style=&quot;margin:0;padding:0&quot;&gt;<br \/>\n<br \/>&nbsp;&lt;p&gt;<br \/>\n<br \/>&nbsp;&lt;label&nbsp;for=&quot;category_title&quot;&gt;Title&lt;\/label&gt;&lt;br&nbsp;\/&gt;<br \/>\n<br \/>&nbsp;&lt;input&nbsp;id=&quot;category_title&quot;&nbsp;name=&quot;category[title]&quot;&nbsp;size=&quot;30&quot;&nbsp;type=&quot;text&quot;&nbsp;\/&gt;<br \/>\n<br \/>&nbsp;&lt;\/p&gt;<br \/>\n<br \/>&nbsp;&lt;p&gt;<br \/>\n<br \/>&nbsp;&lt;input&nbsp;id=&quot;category_submit&quot;&nbsp;name=&quot;commit&quot;&nbsp;type=&quot;submit&quot;&nbsp;value=&quot;Create&quot;&nbsp;\/&gt;<br \/>\n<br \/>&nbsp;&lt;\/p&gt;<br \/>\n<br \/>&lt;\/form&gt;\n<\/p><\/blockquote>\n<p><\/code><\/p>\n<p>Documentation: ActionView::Helpers::FormHelper<\/p>\n<p><a name=\"edit\"><\/p>\n<h1>Tailoring the Generated Scaffold Code<\/h1>\n<p><\/a><\/p>\n<p>The code generated by the Scaffold script is perfectly usable 'out of the box', and is robust once you have added enough validation into your data model. However, if that's all there was to developing Rails applications, then all the Rails apps would be boring.  Now that we understand a little bit of what's going on, we can start to tailor the application to do exactly what we want.<\/p>\n<p><a name=\"edit-controller\"><\/p>\n<h2>Modifying the Controller<\/h2>\n<p><\/a><\/p>\n<p>In a list view, as we can see on the mail page, I would expect the records to be displayed in alphabetical order. This requires a minor change to<br \/>\nthe controller:<\/p>\n<p><code><strong>appcontrollerscategories_controller.rb (excerpt)<\/strong><\/p>\n<blockquote><p>\n#&nbsp;GET&nbsp;\/categories<br \/>\n<br \/>&nbsp;&nbsp;#&nbsp;GET&nbsp;\/categories.xml<br \/>\n<br \/>&nbsp;&nbsp;def&nbsp;index<br \/>\n<br \/>&nbsp;&nbsp;&nbsp;&nbsp;@categories&nbsp;=&nbsp;Category.find(:all,&nbsp;<strong>:order=&gt;'title'<\/strong>)<\/p>\n<p>&nbsp;&nbsp;&nbsp;&nbsp;respond_to&nbsp;do&nbsp;|format|<br \/>\n<br \/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;format.html&nbsp;#&nbsp;index.html.erb<br \/>\n<br \/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;format.xml&nbsp;&nbsp;{&nbsp;render&nbsp;:xml&nbsp;=&gt;&nbsp;@categories&nbsp;}<br \/>\n<br \/>&nbsp;&nbsp;&nbsp;&nbsp;end<br \/>\n<br \/>&nbsp;&nbsp;end\n<\/p><\/blockquote>\n<p><\/code><\/p>\n<p>Remember that Category is an ActiveRecord, so you can look up the find method on ActiveRecord::Base and see all the nifty options.<\/p>\n<p>Documentation: ActiveRecord::Base.find<\/p>\n<p>In this application, the show screen is unnecessary - all the fields fit comfortably on a single row on the screen.<br \/>\nSo, def show can disappear, and let's go straight back to the list screen (categories index) after an 'Edit':<\/p>\n<p><code><br \/>\n<strong>(excerpt)<\/strong><\/p>\n<blockquote><p>\n(excerpt)<br \/>\n<br \/>&nbsp;#&nbsp;POST&nbsp;\/categories<br \/>\n<br \/>&nbsp;&nbsp;#&nbsp;POST&nbsp;\/categories.xml<br \/>\n<br \/>&nbsp;&nbsp;def&nbsp;create<br \/>\n<br \/>&nbsp;&nbsp;&nbsp;&nbsp;@category&nbsp;=&nbsp;Category.new(params[:category])<\/p>\n<p>&nbsp;&nbsp;&nbsp;&nbsp;respond_to&nbsp;do&nbsp;|format|<br \/>\n<br \/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;@category.save<br \/>\n<br \/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flash[:notice]&nbsp;=&nbsp;'Category&nbsp;was&nbsp;successfully&nbsp;created.'<br \/>\n<br \/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;format.html&nbsp;{&nbsp;<strong>redirect_to&nbsp;:action&nbsp;=&gt;&nbsp;&quot;index&quot;<\/strong>&nbsp;&nbsp;}<br \/>\n<br \/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;format.xml&nbsp;&nbsp;{&nbsp;render&nbsp;:xml&nbsp;=&gt;&nbsp;@category,&nbsp;:status&nbsp;=&gt;&nbsp;:created,&nbsp;:location&nbsp;=&gt;&nbsp;@category&nbsp;}<br \/>\n<br \/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else<br \/>\n<br \/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;format.html&nbsp;{&nbsp;render&nbsp;:action&nbsp;=&gt;&nbsp;&quot;new&quot;&nbsp;}<br \/>\n<br \/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;format.xml&nbsp;&nbsp;{&nbsp;render&nbsp;:xml&nbsp;=&gt;&nbsp;@category.errors,&nbsp;:status&nbsp;=&gt;&nbsp;:unprocessable_entity&nbsp;}<br \/>\n<br \/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end<br \/>\n<br \/>&nbsp;&nbsp;&nbsp;&nbsp;end<br \/>\n<br \/>&nbsp;&nbsp;end<\/p>\n<p>&nbsp;&nbsp;#&nbsp;PUT&nbsp;\/categories\/1<br \/>\n<br \/>&nbsp;&nbsp;#&nbsp;PUT&nbsp;\/categories\/1.xml<br \/>\n<br \/>&nbsp;&nbsp;def&nbsp;update<br \/>\n<br \/>&nbsp;&nbsp;&nbsp;&nbsp;@category&nbsp;=&nbsp;Category.find(params[:id])<\/p>\n<p>&nbsp;&nbsp;&nbsp;&nbsp;respond_to&nbsp;do&nbsp;|format|<br \/>\n<br \/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;@category.update_attributes(params[:category])<br \/>\n<br \/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>flash[:notice]<\/strong>&nbsp;=&nbsp;'Category&nbsp;was&nbsp;successfully&nbsp;updated.'<br \/>\n<br \/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;format.html&nbsp;{&nbsp;<strong>redirect_to&nbsp;:action&nbsp;=&gt;&nbsp;&quot;index&quot;<\/strong>&nbsp;}<br \/>\n<br \/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;format.xml&nbsp;&nbsp;{&nbsp;head&nbsp;:ok&nbsp;}<br \/>\n<br \/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else<br \/>\n<br \/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;format.html&nbsp;{&nbsp;render&nbsp;:action&nbsp;=&gt;&nbsp;&quot;edit&quot;&nbsp;}<br \/>\n<br \/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;format.xml&nbsp;&nbsp;{&nbsp;render&nbsp;:xml&nbsp;=&gt;&nbsp;@category.errors,&nbsp;:status&nbsp;=&gt;&nbsp;:unprocessable_entity&nbsp;}<br \/>\n<br \/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end<br \/>\n<br \/>&nbsp;&nbsp;&nbsp;&nbsp;end<br \/>\n<br \/>&nbsp;&nbsp;end\n<\/p><\/blockquote>\n<p>The flash message will be picked up and displayed on the next screen to be displayed - in this case, the list screen.<\/p>\n<p><a name=\"vars\"><\/p>\n<h2>Sharing Variables between the Template and Layout<\/h2>\n<p><\/a><\/p>\n<p>Below you can see that I've moved the &lt;h1&gt;...&lt;\/h1&gt; heading text out of the Template into the Layout so that we can keep the formatting consitent across pages. As each template will have a different heading, I need to set the value of the variable @heading in the Template. Rails is quite ok with this - Template variables are available to Layouts at rendering<br \/>\ntime.<\/p>\n<p><code><br \/>\nappviewslayoutscategories.html.erb (exceprt)<\/p>\n<blockquote><p>\n&lt;head&gt;<br \/>\n<br \/>&nbsp;&nbsp;&lt;meta&nbsp;http-equiv=&quot;content-type&quot;&nbsp;content=&quot;text\/html;charset=UTF-8&quot;&nbsp;\/&gt;<br \/>\n<br \/>&nbsp;&nbsp;&lt;title&gt;Categories:&nbsp;&lt;%=&nbsp;controller.action_name&nbsp;%&gt;&lt;\/title&gt;<br \/>\n<br \/>&nbsp;&nbsp;&lt;%=&nbsp;stylesheet_link_tag&nbsp;'scaffold'&nbsp;%&gt;<br \/>\n<br \/>&lt;\/head&gt;<br \/>\n<br \/>&lt;body&gt;<br \/>\n<br \/><strong>&lt;h1&gt;&lt;%=@heading&nbsp;%&gt;&lt;\/h1&gt;<\/strong><br \/>\n<br \/>...\n<\/p><\/blockquote>\n<p><\/code><\/p>\n<p><code><br \/>\napp\/views\/categories\/index.html.erb (excerpt)<\/p>\n<blockquote><p>\n<strong>&lt;%&nbsp;@heading&nbsp;=&nbsp;&quot;Categories&quot;&nbsp;%&gt;<\/strong><br \/>\n<br \/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br \/>\n<br \/>&lt;table&gt;<br \/>\n<br \/>&nbsp;&nbsp;&lt;tr&gt;<br \/>\n<br \/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;th&gt;Title&lt;\/th&gt;<br \/>\n<br \/>&nbsp;&nbsp;&lt;\/tr&gt;<br \/>\n<br \/>&nbsp;<br \/>\n<br \/>&lt;%&nbsp;for&nbsp;category&nbsp;in&nbsp;@categories&nbsp;%&gt;<br \/>\n<br \/>&nbsp;&nbsp;&lt;tr&gt;<br \/>\n<br \/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;&lt;%=h&nbsp;category.title&nbsp;%&gt;&lt;\/td&gt;<br \/>\n<strong><br \/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;&lt;%=&nbsp;category[&quot;created_at&quot;].strftime(&quot;%I:%M&nbsp;%p&nbsp;%d-%b-%y&quot;)&nbsp;%&gt;&lt;\/td&gt;&nbsp;&nbsp;&nbsp;&nbsp;<br \/>\n<br \/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;&lt;%=&nbsp;category[&quot;updated_at&quot;].strftime(&quot;%I:%M&nbsp;%p&nbsp;%d-%b-%y&quot;)&nbsp;%&gt;&lt;\/td&gt;<\/strong><\/p>\n<p>&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;&lt;%=&nbsp;link_to&nbsp;'Edit',&nbsp;edit_category_path(category)&nbsp;%&gt;&lt;\/td&gt;<br \/>\n<br \/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;&lt;%=&nbsp;link_to&nbsp;'Destroy',&nbsp;category,&nbsp;:confirm&nbsp;=&gt;&nbsp;'Are&nbsp;you&nbsp;sure?',&nbsp;:method&nbsp;=&gt;&nbsp;:delete&nbsp;%&gt;&lt;\/td&gt;<br \/>\n<br \/>&nbsp;&nbsp;&lt;\/tr&gt;<br \/>\n<br \/>&lt;%&nbsp;end&nbsp;%&gt;<br \/>\n<br \/>&lt;\/table&gt;\n<\/p><\/blockquote>\n<p><\/code><\/p>\n<p>Since we removed the 'show' action above, I've also removed the link in the categories list view.  Then I added created_at and updated_at, which if you recall from Day 1, were auto-generated for us as part of the scaffold.<\/p>\n<p>Instead of the default date format (e.g. Sat Dec 13 23:26:19 UTC 2008), we're using a Ruby method strftime() to format the date and time fields (e.g. 11:26 PM 13-Dec-08)<\/p>\n<p>Ruby Documentation: class Time<\/p>\n<p><a name=\"partial\"><\/p>\n<h2>Partial Templates<\/h2>\n<p><\/a><\/p>\n<p>You may have noticed that edit and new are almost idential.  The scaffold does not assume that will be your design, so it doesn't prematurely optimize; however, in this app the new and edit pages share almost all of the same elements.  Rails can allow these templates to share code by using a \"partial\" template.  Create a new file called _category (all partial templates begin with an '_' per Rails convention) and insert the shared code:<\/p>\n<p><code><br \/>\n<strong>app\/views\/categories\/_category.html.erb<\/strong><\/p>\n<blockquote><p>\n&lt;%&nbsp;form_for(@category)&nbsp;do&nbsp;|f|&nbsp;%&gt;<br \/>\n<br \/>&nbsp;&nbsp;&lt;%=&nbsp;f.error_messages&nbsp;%&gt;<\/p>\n<p>&nbsp;&nbsp;&lt;p&gt;<br \/>\n<br \/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;%=&nbsp;f.label&nbsp;:title&nbsp;%&gt;&lt;br&nbsp;\/&gt;<br \/>\n<br \/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;%=&nbsp;f.text_field&nbsp;:title&nbsp;%&gt;<br \/>\n<br \/>&nbsp;&nbsp;&lt;\/p&gt;<br \/>\n<br \/>&nbsp;&nbsp;&lt;p&gt;<br \/>\n<br \/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;%=&nbsp;f.submit&nbsp;<strong>button_name<\/strong>&nbsp;%&gt;<br \/>\n<br \/>&nbsp;&nbsp;&lt;\/p&gt;<br \/>\n<br \/>&lt;%&nbsp;end&nbsp;%&gt;<\/p>\n<p>&lt;%=&nbsp;link_to&nbsp;'Back',&nbsp;categories_path&nbsp;%&gt;\n<\/p><\/blockquote>\n<p><\/code><\/p>\n<p>This makes the edit and new templates very short and sweet.  Note the use of the variable button_name, which you can see in action below. <\/p>\n<p><code><br \/>\n<strong>app\/views\/categories\/edit.html.erb (that's the whole thing!)<\/strong><\/p>\n<blockquote><p>\n<strong>&lt;%&nbsp;@heading&nbsp;=&nbsp;&quot;Edit&nbsp;Category&quot;&nbsp;%&gt;<\/strong><\/p>\n<p>&lt;%=&nbsp;render&nbsp;:partial&nbsp;=&gt;&nbsp;@category,<br \/>\n<br \/>&nbsp;&nbsp;:locals&nbsp;=&gt;&nbsp;{&nbsp;:<strong>button_name&nbsp;=&gt;&nbsp;&quot;Update&quot;<\/strong>}&nbsp;%&gt;\n<\/p><\/blockquote>\n<p><code><\/p>\n<p><code><strong><br \/>\napp\/views\/categories\/new.html.erb<\/strong><\/p>\n<blockquote><p>\n<strong>&lt;%&nbsp;@heading&nbsp;=&nbsp;&quot;New&nbsp;Category&quot;&nbsp;%&gt;<\/strong><\/p>\n<p>&lt;%=&nbsp;render&nbsp;:partial&nbsp;=&gt;&nbsp;@category,<br \/>\n<br \/>&nbsp;&nbsp;:locals&nbsp;=&gt;&nbsp;{&nbsp;:<strong>button_name&nbsp;=&gt;&nbsp;&quot;Create&quot;<\/strong>}&nbsp;%&gt;\n<\/p><\/blockquote>\n<p><\/code><\/p>\n<p>Now we have a nicely modular webapp following the DRY principle without that unsightly repeated code.  We also understand much of the code that defines our little app.<\/p>\n<p><a name=\"review\"><\/p>\n<h1>What did we learn?<\/h1>\n<p><\/a><\/p>\n<p>We learned about the following files that were created by the generate scaffold script:<\/p>\n<ul>\n<li>app\/models\/category.rb<\/li>\n<li>app\/controllers\/categories_controller.rb   <\/li>\n<li>app\/view\/layouts\/categories.html.erb<\/li>\n<li>app\/view\/categories\/\n<ul>\n<li>            index.html.erb<\/li>\n<li>            show.html.erb<\/li>\n<li>\t    edit.html.erb\t\t<\/li>\n<li>            new.html.erb\t<\/li>\n<\/ul>\n<\/li>\n<\/ul>\n<p>We also learned how to create a partial template: _category.html.erb.<\/p>\n<p>I learned more of the Ruby language and how to navigate the Ruby API docs, and I hope you did too.  This tutorial got a bit long and required quite a bit of changes from the old one.  Please comment if you find any errors and I'll fix up up for posterity.<\/p>\n<p>Notably absent from this tutorial has been the famous unit testing that I hear all good Ruby developers swear by. Perhaps I'll need to go offscript and read up on that for Day 3.<\/p>\n<p>Stay tuned.<\/p>\n","protected":false},"excerpt":{"rendered":"<p>In Day 1 with Rails, we built a simple application that let us manage a list of categories using the powerful generate scaffold script. Today, we&#8217;ll look under the hood and learn about the code that was created for us, so that we can modify the application to do just what we want (or, rather,&hellip; <a href=\"https:\/\/www.ultrasaurus.com\/2008\/12\/getting-started-with-rails-2-day-2\/\">Continue reading <span class=\"meta-nav\">&rarr;<\/span><\/a><\/p>\n","protected":false},"author":84,"featured_media":0,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":[],"categories":[2],"tags":[],"_links":{"self":[{"href":"https:\/\/www.ultrasaurus.com\/wp-json\/wp\/v2\/posts\/598"}],"collection":[{"href":"https:\/\/www.ultrasaurus.com\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/www.ultrasaurus.com\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/www.ultrasaurus.com\/wp-json\/wp\/v2\/users\/84"}],"replies":[{"embeddable":true,"href":"https:\/\/www.ultrasaurus.com\/wp-json\/wp\/v2\/comments?post=598"}],"version-history":[{"count":0,"href":"https:\/\/www.ultrasaurus.com\/wp-json\/wp\/v2\/posts\/598\/revisions"}],"wp:attachment":[{"href":"https:\/\/www.ultrasaurus.com\/wp-json\/wp\/v2\/media?parent=598"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/www.ultrasaurus.com\/wp-json\/wp\/v2\/categories?post=598"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/www.ultrasaurus.com\/wp-json\/wp\/v2\/tags?post=598"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}