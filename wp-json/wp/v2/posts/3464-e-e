{"id":3464,"date":"2011-11-24T19:08:54","date_gmt":"2011-11-25T03:08:54","guid":{"rendered":"https:\/\/www.ultrasaurus.com\/?p=3464"},"modified":"2011-11-24T19:08:54","modified_gmt":"2011-11-25T03:08:54","slug":"setting-up-ec2-minecraft-server","status":"publish","type":"post","link":"https:\/\/www.ultrasaurus.com\/2011\/11\/setting-up-ec2-minecraft-server\/","title":{"rendered":"setting up ec2 minecraft server"},"content":{"rendered":"<p>Goal: set up a minecraft server using free EC2 account from OSX<br \/>\n[update: FAIL &#8212; game play doesn&#8217;t work on a micro instance, if we want to use EC2 it looks like we need to use at least a small one. so be careful to adjust the steps below to pick a small instance if you want to play.]<\/p>\n<p>I learned that there are a lot of minecraft server implementations.  I decided to use Craftbukkit server largely because I saw it referenced from a <a href=\"http:\/\/confreaks.net\/videos\/696-rubyconf2011-be-a-minecraft-modman-with-purugin\">RubyConf talk<\/a> by <a href=\"http:\/\/blog.enebo.com\/\">Tom Enebo<\/a> &#8212; might be fun to mod it someday :)<\/p>\n<p>I pieced together information from some helpful tutorials from <a href=\"https:\/\/help.ubuntu.com\/community\/EC2StartersGuide\">Ubuntu<\/a> and <a href=\"http:\/\/www.robertsosinski.com\/2008\/01\/26\/starting-amazon-ec2-with-mac-os-x\/\">Robert Sosinski<\/a>.<\/p>\n<ol>\n<li>Sign-up for an AWS account (1 year free for new AWS accounts, but you need a credit card)<\/li>\n<li>Go to <a href=\"https:\/\/console.aws.amazon.com\/ec2\/home\">AWS Management Console<\/a><\/li>\n<li>Create a Private Key\n<ul>\n<li>Select EC2 tab, click on &#8220;0 Key Pairs&#8221; on the right side<\/li>\n<li>name it ec2.pem (or anything you want, but I&#8217;ll use ec2 in the rest of this tutorial)<\/li>\n<li>save it to ~\/.ec2\/ec2.pem<\/li>\n<\/ul>\n<\/li>\n<li>Create a Certificate\n<ul>\n<li>Under your name in the top right corner, select &#8220;Security Credentials&#8221;<\/li>\n<li>Download the private key and certificate and save them in ~\/.ec2<\/li>\n<\/ul>\n<\/li>\n<li>Make your credential files private.\u00a0 In your local terminal, type:\n<ul>\n<li>cd ~\/.ec2<\/li>\n<li>chmod go-rwx ~\/.ec2\/*.pem<\/li>\n<\/ul>\n<\/li>\n<li>Download <a href=\"http:\/\/aws.amazon.com\/developertools\/351\">EC2 API Tools<\/a>\n<ul>\n<li>Unzip the Amazon EC2 Command-Line Tools<\/li>\n<li>Move both the bin and lib directory into your ~\/.ec2 directory<\/li>\n<\/ul>\n<\/li>\n<li>Your ~\/.ec2 directory should have:\n<ul>\n<li>The cert-xxxxxxx.pem file<\/li>\n<li>The pk-xxxxxxx.pem file<\/li>\n<li>The bin directory<\/li>\n<li>The lib directory<\/li>\n<li>ec2.pem<\/li>\n<\/ul>\n<\/li>\n<li>Set up EC2 Command-line Tools\n<ul>\n<li>Put the following into your ~\/.bash_profile:<br \/>\n<code># Setup Amazon EC2 Command-Line Tools<br \/>\nexport EC2_HOME=~\/.ec2<br \/>\nexport PATH=$PATH:$EC2_HOME\/bin<br \/>\nexport EC2_PRIVATE_KEY=`ls $EC2_HOME\/pk-*.pem`<br \/>\nexport EC2_CERT=`ls $EC2_HOME\/cert-*.pem`<br \/>\nexport JAVA_HOME=\/System\/Library\/Frameworks\/JavaVM.framework\/Home\/<\/code><\/li>\n<li>On the command-line, type:<br \/>\n<code>source ~\/.bash_profile<\/code><\/li>\n<\/ul>\n<\/li>\n<li>Startup a server\n<ul>\n<li>[Update] We want to be careful to choose an AMI that works with the micro instance, which is what we get for free.\u00a0 Ubuntu takes up too much disk space by default to fit into a micro instance, so you need to use one of the <a href=\"http:\/\/cloud.ubuntu.com\/2010\/11\/using-ubuntu-images-on-aws-free-tier\/\">micro Ubuntu AMIs<\/a> they created for this purpose.\u00a0 I&#8217;m going to use Maverick 10-10 &#8212; it&#8217;s the most recent version that has a micro version.<\/li>\n<li>[Update] I picked one in us-east, since that&#8217;s where Amazon started my account by default and it seems that it needs to be in the same region matching the one set for my key:<br \/>\nec2-run-instances ami-cf33fea6 &#8211;instance-type t1.micro &#8211;region us-east-1 &#8211;key ec2<\/li>\n<li>check to see if it is running, by typing:<br \/>\n<code>ec2-describe-instances<\/code><\/li>\n<li>make a note of your hostname!\u00a0 It should look something like:<\/li>\n<\/ul>\n<pre>ec2-###-##-##-##.compute-1.amazonaws.com<\/pre>\n<\/li>\n<li>Open relevant ports (22 for ssh, 80 for http, 25565 for minecraft):<code><br \/>\nec2-authorize default -p 22<br \/>\nec2-authorize default -p 80<br \/>\nec2-authorize default -p 25565<br \/>\n<\/code><\/li>\n<li>ssh into your new instance<br \/>\n<code>ssh -i ec2.pem ubuntu@ec2-###-##-##-##.compute-1.amazonaws.com<\/code><\/li>\n<li>Install Java (<a href=\"http:\/\/ubuntu-for-humans.blogspot.com\/2011\/04\/installing-java-on-ubuntu-server-1010.html\">nice Ubuntu instructions<\/a>)<br \/>\nNote: to accept the license, use tab to get to the OK &#8220;button&#8221; then hit return, then arrow to get to &#8220;Yes&#8221; and hit return again.<br \/>\nTo verify installation:<br \/>\n$ java -version<br \/>\njava version &#8220;1.6.0_26&#8221;<br \/>\nJava(TM) SE Runtime Environment (build 1.6.0_26-b03)<br \/>\nJava HotSpot(TM) Client VM (build 20.1-b02, mixed mode, sharing)<\/li>\n<li>See <a href=\"http:\/\/wiki.bukkit.org\/Setting_up_a_remote_Linux_server\">this tutorial for setting up minecraft<\/a>, but if you are playing with the Minecraft 1.0 client (at least of today) you&#8217;ll need to install a dev build which you can find on the <a href=\"http:\/\/ci.bukkit.org\/job\/dev-CraftBukkit\/\">ci server<\/a>. I found that I needed to run the server, stop it and run it again to get it to start without errors.\n<ul>\n<li>get the latest dev build (I&#8217;m running 1502):\n<pre>\nwget http:\/\/ci.bukkit.org\/job\/dev-CraftBukkit\/lastSuccessfulBuild\/artifact\/target\/craftbukkit-1.0.0-SNAPSHOT.jar\n<\/pre>\n<\/li>\n<li>create a file called &#8220;start.sh&#8221; with the following contents:\n<pre>\n#!\/bin\/sh\njava -Xmx613M -Xincgc -jar craftbukkit-1.0.0-SNAPSHOT.jar\n<\/pre>\n<\/li>\n<li>run the server in screen:\n<pre>\nscreen\n.\/start.sh\n<\/pre>\n<\/li>\n<\/ol>\n<p>[Update] By tweaking the memory allocation, we can get it to work (most of the time) with a single player.  I found that I can raise the memory allocation for java and use virtual memory, but that it sometimes maxes out the CPU.  <\/p>\n<p>Here&#8217;s the setting where the game couldn&#8217;t be failed (couldn&#8217;t fight monsters or build things):<\/p>\n<pre>#!\/bin\/sh\njava -Xmx613M -Xincgc -jar craftbukkit-1.0.0-SNAPSHOT.jar\n\n$top\n  PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND                                                                 \n 1642 ubuntu    20   0  978m 300m  10m S 12.3 50.7 100:44.96 java                                                                     \n<\/pre>\n<p>Note:<br \/>\nVIRT &#8211; 978M of virtual memory<br \/>\nRES &#8211; 300m resident (physical) memory<\/p>\n<hr \/>\n<p>With this it sometimes works:<\/p>\n<pre>\n#!\/bin\/sh\njava -Xmx1024M -Xincgc -jar craftbukkit-1.0.0-SNAPSHOT.jar\n\n 2829 ubuntu    20   0 1336m 271m  10m S 14.0 45.8   0:18.76 java                                                                     \n<\/pre>\n<hr \/>\n<p>With this works almost all the time (but we&#8217;ve only tested one player):<\/p>\n<pre>\n#!\/bin\/sh\njava -Xmx2048M -Xincgc -jar craftbukkit-1.0.0-SNAPSHOT.jar\n\n  PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND                                                                 \n 2893 ubuntu    20   0 2499m 341m  10m S 99.8 57.6   0:27.68 java                                                                     \n\n 2893 ubuntu    20   0 2499m 341m  10m S 18.2 57.7   1:27.30 java                     <\/pre>\n<p>when the CPU maxes out, I see this in the game console:<br \/>\n<code>22:39:19 [WARNING] Can't keep up! Did the system time change, or is the server overloaded?<\/code><\/p>\n","protected":false},"excerpt":{"rendered":"<p>Goal: set up a minecraft server using free EC2 account from OSX [update: FAIL &#8212; game play doesn&#8217;t work on a micro instance, if we want to use EC2 it looks like we need to use at least a small one. so be careful to adjust the steps below to pick a small instance if&hellip; <a href=\"https:\/\/www.ultrasaurus.com\/2011\/11\/setting-up-ec2-minecraft-server\/\">Continue reading <span class=\"meta-nav\">&rarr;<\/span><\/a><\/p>\n","protected":false},"author":84,"featured_media":0,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":[],"categories":[3],"tags":[],"_links":{"self":[{"href":"https:\/\/www.ultrasaurus.com\/wp-json\/wp\/v2\/posts\/3464"}],"collection":[{"href":"https:\/\/www.ultrasaurus.com\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/www.ultrasaurus.com\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/www.ultrasaurus.com\/wp-json\/wp\/v2\/users\/84"}],"replies":[{"embeddable":true,"href":"https:\/\/www.ultrasaurus.com\/wp-json\/wp\/v2\/comments?post=3464"}],"version-history":[{"count":0,"href":"https:\/\/www.ultrasaurus.com\/wp-json\/wp\/v2\/posts\/3464\/revisions"}],"wp:attachment":[{"href":"https:\/\/www.ultrasaurus.com\/wp-json\/wp\/v2\/media?parent=3464"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/www.ultrasaurus.com\/wp-json\/wp\/v2\/categories?post=3464"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/www.ultrasaurus.com\/wp-json\/wp\/v2\/tags?post=3464"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}