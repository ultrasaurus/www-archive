{"id":5186,"date":"2014-08-09T18:22:38","date_gmt":"2014-08-10T01:22:38","guid":{"rendered":"https:\/\/www.ultrasaurus.com\/?p=5186"},"modified":"2014-08-09T19:33:11","modified_gmt":"2014-08-10T02:33:11","slug":"rspec-3-upgrade-conversion-expect","status":"publish","type":"post","link":"https:\/\/www.ultrasaurus.com\/2014\/08\/rspec-3-upgrade-conversion-expect\/","title":{"rendered":"rspec 3 upgrade: conversion of should to expect"},"content":{"rendered":"<p><strong>update<\/strong>: follow the <a href=\"https:\/\/relishapp.com\/rspec\/docs\/upgrade\">rspec upgrade guide<\/a> and try the <a href=\"https:\/\/github.com\/yujinakayama\/transpec\">transpec<\/a> gem<\/p>\n<hr \/>\n<p>Upgrading a Rails app to RSpec 3, I appreciated <a href=\"http:\/\/jakeboxer.com\/blog\/2012\/07\/09\/converting-to-the-new-rspec-2-dot-11-expectation-syntax\/\">Jake Boxer&#8217;s guide<\/a>.  However, his regular expressions didn&#8217;t work in the editors I use, so I whipped up some command-line options that use the flexible unix utility sed.<\/p>\n<p>If you want to actually understand the following scripts, I recommend <a href=\"http:\/\/www.grymoire.com\/unix\/Sed.html#TOC\">Bruce Barnett&#8217;s sed tutorial<\/a> and remember <a href=\"https:\/\/www.ultrasaurus.com\/2008\/06\/bash-xargs-is-your-friend\/\">xargs is your friend<\/a>.<\/p>\n<p>Also, there are a few differences with sed on OSX, so these may not work on other platforms.<\/p>\n<p>I didn&#8217;t attempt to handle multi-lined expressions, so I searched my spec directory for &#8220;lambda&#8221; in advance and changed those manually, and, of course, found a few other exceptions by running my tests afterwards.<\/p>\n<h2>Change &#8220;should ==&#8221; to &#8220;should eq&#8221;<\/h2>\n<p>You&#8217;ll need to change other operators also, but this was a pattern that happened to be very common in my code.<\/p>\n<pre>\nfind . -type f -print0 | xargs -0 sed -i \"\" -E \"s\/^([[:space:]]+)(.*)\\.should ==[:space]*(.*)[:space]*$\/\\1\\2.should eq(\\3)\/g\"\n<\/pre>\n<h2>Change &#8220;whatever.should&#8221; to &#8220;expect(whatever).to&#8221;<\/h2>\n<p>This also works for should_not, since it is okay to say .to_not, even though I usually see people wrote .not_to<\/p>\n<pre>\nfind . -type f -print0 | xargs -0 sed -i \"\" -E \"s\/^([[:space:]]+)(.*)\\.should\/\\1expect(\\2).to\/g\"\n<\/pre>\n<p>Also, check out: <a href=\"http:\/\/www.cyrusstoller.com\/2014\/07\/02\/upgrading-to-rspec-3\/\">Cyrus Stoller&#8217;s upgrade tips<\/a><\/p>\n","protected":false},"excerpt":{"rendered":"<p>update: follow the rspec upgrade guide and try the transpec gem Upgrading a Rails app to RSpec 3, I appreciated Jake Boxer&#8217;s guide. However, his regular expressions didn&#8217;t work in the editors I use, so I whipped up some command-line options that use the flexible unix utility sed. If you want to actually understand the&hellip; <a href=\"https:\/\/www.ultrasaurus.com\/2014\/08\/rspec-3-upgrade-conversion-expect\/\">Continue reading <span class=\"meta-nav\">&rarr;<\/span><\/a><\/p>\n","protected":false},"author":84,"featured_media":0,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":[],"categories":[2],"tags":[],"_links":{"self":[{"href":"https:\/\/www.ultrasaurus.com\/wp-json\/wp\/v2\/posts\/5186"}],"collection":[{"href":"https:\/\/www.ultrasaurus.com\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/www.ultrasaurus.com\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/www.ultrasaurus.com\/wp-json\/wp\/v2\/users\/84"}],"replies":[{"embeddable":true,"href":"https:\/\/www.ultrasaurus.com\/wp-json\/wp\/v2\/comments?post=5186"}],"version-history":[{"count":0,"href":"https:\/\/www.ultrasaurus.com\/wp-json\/wp\/v2\/posts\/5186\/revisions"}],"wp:attachment":[{"href":"https:\/\/www.ultrasaurus.com\/wp-json\/wp\/v2\/media?parent=5186"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/www.ultrasaurus.com\/wp-json\/wp\/v2\/categories?post=5186"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/www.ultrasaurus.com\/wp-json\/wp\/v2\/tags?post=5186"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}