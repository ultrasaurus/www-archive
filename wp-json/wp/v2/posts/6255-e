{"id":6255,"date":"2017-12-30T16:50:03","date_gmt":"2017-12-31T00:50:03","guid":{"rendered":"https:\/\/www.ultrasaurus.com\/?p=6255"},"modified":"2017-12-30T23:27:01","modified_gmt":"2017-12-31T07:27:01","slug":"event-driven-architectural-patterns","status":"publish","type":"post","link":"https:\/\/www.ultrasaurus.com\/2017\/12\/event-driven-architectural-patterns\/","title":{"rendered":"event-driven architectural patterns"},"content":{"rendered":"<p>Martin Fowler&#8217;s talk \u201cThe Many Meanings of Event-Driven Architecture\u201d at GOTO2017 provides a good overview of different patterns that all are described as \u201cevent-driven\u201d systems.  At the end of the talk, he references to an earlier <a href=\"https:\/\/martinfowler.com\/articles\/201701-event-driven.html\">event-driven article<\/a>, which offers a good prose description of these different patterns that folks are calling event-driven programming. In this talk, he covers specific examples that illustrate the patterns, grounding them in specific applications.<\/p>\n<p><iframe loading=\"lazy\" width=\"770\" height=\"433\" src=\"https:\/\/www.youtube.com\/embed\/STKCRSUsyP0?feature=oembed\" frameborder=\"0\" gesture=\"media\" allow=\"encrypted-media\" allowfullscreen><\/iframe><\/p>\n<h2>Event Notification<\/h2>\n<p><img loading=\"lazy\" src=\"https:\/\/www.ultrasaurus.com\/wp-content\/uploads\/2017\/06\/fowler-events-1.png\" alt=\"Person -&gt; CRM -&gt; Insurance Quoting -&gt; Communications\" width=\"208\" height=\"262\" class=\"thumbnail alignright size-full wp-image-6258\" \/>For example: address changed<\/p>\n<p>Scenario: CRM system stores information about people. An insurance quoting system generates insurance rates based on demographics and address. When someone&#8217;s address changes, we need to calculate a new value for the cost of insurance.<\/p>\n<p>We often don\u2019t want these systems to be coupled, instead we want a reversal of dependencies. This patterns is used in relatively large scale systems, and also a long-established client-side pattern to separate GUIs and the rest of your code.<\/p>\n<p>The change becomes a first class notion.  We bundle the notification + data about the change.<\/p>\n<p>Events OR Commands<br \/>\n* Commands enforce the coupling, it\u2019s very different from an event, it conveys intent<br \/>\n* Naming makes all the diffrence<\/p>\n<p>Additional property \u2192 easy to add systems without modifying the original system<\/p>\n<p>Martin notes \u201cthe dark side of event notification\u201d where your system quickly becomes hard to reason about because there is not statement of overall behavior.<\/p>\n<h2>Event-Carried State Transfer<\/h2>\n<p>Named in contrast to REST (Representational State Transfer), the event carries ALL of the data needed about the event, which completely de-couples the target system from the system that originates the event.<\/p>\n<p>Of course, this introduces data replication and eventual consistency (which can be good for some use cases); however, this is a less common pattern since this lack of consistency can actually make the system more complex.<\/p>\n<h2>Event Sourcing<\/h2>\n<p>This is one of my favorite patterns which Martin explains nicely in the talk with two examples:<\/p>\n<ul>\n<li>Version control is an event source system for code.<\/li>\n<li>Accounting ledgers track every credit or debit, which are the source records (events), and the balance is calculated from those records.<\/li>\n<\/ul>\n<p>Benefits<\/p>\n<ul>\n<li>auditing: natural part of the system<\/li>\n<li>debugging: easy to replay a subset of events locally<\/li>\n<li>historic state: time travel!<\/li>\n<li>alternative state: branching, correcting errors<\/li>\n<li>memory image: application state can be volatile (since persistence is achieved with event log, processing can happen quickly in memory based on recent events that can quickly regenerate state based on recent snapshots)<\/li>\n<\/ul>\n<p>Drawbacks<\/p>\n<ul>\n<li>unfamiliar<\/li>\n<li>external systems: everything needs to be an event<\/li>\n<li>event schema: what happens when your data types change?<\/li>\n<li>identifiers: how to create identifiers to reliably replay events<\/li>\n<\/ul>\n<p>Common (Related) Challenges<\/p>\n<ul>\n<li>**asynchronous processing** can be hard to reason about. This isn&#8217;t required for an event sourcing system, yet it is easy to add and needed in most server-side systems. Useful to remember that this is distinct from the core event sourcing pattern. <\/li>\n<li>**versioning** is another option that is quite useful, yet also adds complexity. Greg Young&#8217;s advice: don&#8217;t have any business logic between the event and the internal representation of a record.<\/li>\n<\/ul>\n<p><img loading=\"lazy\" src=\"https:\/\/www.ultrasaurus.com\/wp-content\/uploads\/2017\/12\/fowler-event-sourcing.png\" alt=\"\" width=\"591\" height=\"339\" class=\"thumbnail alignright size-full wp-image-6373\" srcset=\"https:\/\/www.ultrasaurus.com\/wp-content\/uploads\/2017\/12\/fowler-event-sourcing.png 591w, https:\/\/www.ultrasaurus.com\/wp-content\/uploads\/2017\/12\/fowler-event-sourcing-300x172.png 300w\" sizes=\"(max-width: 591px) 100vw, 591px\" \/><\/p>\n<p>Martin talks about the difference between input event (the intention) and the output event (the effect). In deciding what to store think about how we would fix a bug. The key thing is to be clear about what you are storing, and probably most of the time you want to store both.<\/p>\n<h2>CQRS<\/h2>\n<p>Coined by Greg Young, <strong>Command Query Responsibility Segregation,<\/strong> is where your write model is different from your read model.  Two software components: one for updating the current model (the command component), and one for reading the state (the query component).<\/p>\n<p><img loading=\"lazy\" src=\"https:\/\/www.ultrasaurus.com\/wp-content\/uploads\/2017\/12\/fowler-cqrs.png\" alt=\"\" width=\"601\" height=\"336\" class=\"thumbnail alignright size-full wp-image-6372\" srcset=\"https:\/\/www.ultrasaurus.com\/wp-content\/uploads\/2017\/12\/fowler-cqrs.png 601w, https:\/\/www.ultrasaurus.com\/wp-content\/uploads\/2017\/12\/fowler-cqrs-300x168.png 300w\" sizes=\"(max-width: 601px) 100vw, 601px\" \/><\/p>\n<p>Martin suggests that we need to be wary of this approach.  A good pattern when used appropriately (which you could say of any model).  But isn&#8217;t Event Sourcing just a special case of this?  Maybe the special case is what provides a structure that make it easier to reason about.<\/p>\n","protected":false},"excerpt":{"rendered":"<p>Martin Fowler&#8217;s talk \u201cThe Many Meanings of Event-Driven Architecture\u201d at GOTO2017 provides a good overview of different patterns that all are described as \u201cevent-driven\u201d systems. At the end of the talk, he references to an earlier event-driven article, which offers a good prose description of these different patterns that folks are calling event-driven programming. In&hellip; <a href=\"https:\/\/www.ultrasaurus.com\/2017\/12\/event-driven-architectural-patterns\/\">Continue reading <span class=\"meta-nav\">&rarr;<\/span><\/a><\/p>\n","protected":false},"author":84,"featured_media":0,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":[],"categories":[2],"tags":[],"_links":{"self":[{"href":"https:\/\/www.ultrasaurus.com\/wp-json\/wp\/v2\/posts\/6255"}],"collection":[{"href":"https:\/\/www.ultrasaurus.com\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/www.ultrasaurus.com\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/www.ultrasaurus.com\/wp-json\/wp\/v2\/users\/84"}],"replies":[{"embeddable":true,"href":"https:\/\/www.ultrasaurus.com\/wp-json\/wp\/v2\/comments?post=6255"}],"version-history":[{"count":23,"href":"https:\/\/www.ultrasaurus.com\/wp-json\/wp\/v2\/posts\/6255\/revisions"}],"predecessor-version":[{"id":6387,"href":"https:\/\/www.ultrasaurus.com\/wp-json\/wp\/v2\/posts\/6255\/revisions\/6387"}],"wp:attachment":[{"href":"https:\/\/www.ultrasaurus.com\/wp-json\/wp\/v2\/media?parent=6255"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/www.ultrasaurus.com\/wp-json\/wp\/v2\/categories?post=6255"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/www.ultrasaurus.com\/wp-json\/wp\/v2\/tags?post=6255"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}