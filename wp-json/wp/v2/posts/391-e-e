{"id":391,"date":"2008-06-15T11:00:24","date_gmt":"2008-06-15T19:00:24","guid":{"rendered":"https:\/\/www.ultrasaurus.com\/wordpress\/?p=391"},"modified":"2008-06-15T11:00:24","modified_gmt":"2008-06-15T19:00:24","slug":"pipes-redirects-and-awk-v","status":"publish","type":"post","link":"https:\/\/www.ultrasaurus.com\/2008\/06\/pipes-redirects-and-awk-v\/","title":{"rendered":"pipes, redirects and awk -v"},"content":{"rendered":"<p>I wanted to take the output of a command and put it in a temporary variable so I can append a string to it.  (Trying to script perforce to append something to my client spec without interactive involvement.)<\/p>\n<p>First attempt:<br \/>\n$ p4 client -o &gt; $CLIENTSPEC<br \/>\nc:cygwinbinbash: $CLIENTSPEC: ambiguous redirect<br \/>\nI later learned that redirect is only for files.<\/p>\n<p>Next attempt:<br \/>\n$ TEST=`p4 client -o`<br \/>\n$ echo $TEST<br \/>\n\/\/depot\/apps\/diamond-calendar-preview\/&#8230; \/\/sallen-LENOVO\/svn\/openlaszlo\/branches\/pagan-deities\/diamond-calen \/\/depot\/apps\/diamond-amaranth-ms2\/&#8230; \/\/sallen-LENOVO\/svn\/openlaszlo\/branches\/pagan-deities\/diamond-amaranth- \/\/depot\/sandbox\/my-webtops\/&#8230; \/\/sallen-LENOVO\/svn\/openlaszlo\/branches\/wafflecone\/diamond\/client\/my-webtops\/. ..<br \/>\nwhich seems to have swallowed line endings and only provided the last few lines of output.<\/p>\n<p>My colleagues at Laszlo, Trebor Fenstermaker and <a href=\"http:\/\/www.samsarin.com\/blog\/\">Chris Pettitt<\/a> and <a href=\"http:\/\/pt.withy.org\/\">ptw<\/a>, showed me the error of my ways and provided some good tips.  Trebor noted that there is a length limit for shell variables and that line endings will get lost.  Chris introduced a combination of pipe and awk -v which did the trick.  At first I thought Tucker&#8217;s simple echo solution wasn&#8217;t working, but he pointed out that I just needed to properly parenthesize my commands.<\/p>\n<p><strong>What worked:<\/strong><br \/>\np4 client -o | awk -v append=&#8221;    \/\/depot\/apps\/test\/&#8230; \/\/sallen-test\/svn\/openlaszlo\/branches\/pagan-deities\/test\/&#8230;&#8221; &#8216;{ print $0 } END { print append }&#8217; | p4 client -i<\/p>\n<p><strong>Even simpler:<\/strong><br \/>\n(p4 client -o; echo &#8221;    \/\/depot\/apps\/test\/&#8230; \/\/sallen-test\/svn\/openlaszlo\/branches\/pagan-deities\/test\/&#8230;&#8221; ) | p4 client -i<\/p>\n<p><strong>Notes:<\/strong><\/p>\n<ul>\n<li><a href=\"http:\/\/en.wikipedia.org\/wiki\/Redirection_%28Unix%29\">Redirect<\/a> only works for files, there are lots of different types of redirects  (&gt; is a simple redirect of stdout to a file, &gt;&gt; will append to a file, 2&gt; will redirect stderr)<\/li>\n<li>awk -v will define a variable which can then be used in the awk script<\/li>\n<li>You need to properly parenthesize your commands:\n<p>( p4 client -o; echo &#8220;Thing to append&#8221; ) | p4 client -i<\/p>\n<p>The parens will execute the p4 and echo commands in a sub-shell so the output of both will be piped to the next.  Without the parens you have said:<\/p>\n<p>p4 client -o; ( echo &#8220;Thing to append&#8221; | p4 client -i )<\/p>\n<p>I.e., run the client command, then run echo to a pipe. <\/li>\n<li><a href=\"http:\/\/en.wikipedia.org\/wiki\/Pipe_%28Unix%29\">Pipe<\/a> will let you take the stdout of one command and send it to the stdin of another:<br \/><img src=\"http:\/\/upload.wikimedia.org\/wikipedia\/en\/thumb\/f\/f6\/Pipeline.svg\/280px-Pipeline.svg.png\" \/><\/li>\n<\/ul>\n","protected":false},"excerpt":{"rendered":"<p>I wanted to take the output of a command and put it in a temporary variable so I can append a string to it. (Trying to script perforce to append something to my client spec without interactive involvement.) First attempt: $ p4 client -o &gt; $CLIENTSPEC c:cygwinbinbash: $CLIENTSPEC: ambiguous redirect I later learned that redirect&hellip; <a href=\"https:\/\/www.ultrasaurus.com\/2008\/06\/pipes-redirects-and-awk-v\/\">Continue reading <span class=\"meta-nav\">&rarr;<\/span><\/a> <a href=\"https:\/\/www.ultrasaurus.com\/2008\/06\/pipes-redirects-and-awk-v\/\">Continue reading <span class=\"meta-nav\">&rarr;<\/span><\/a><\/p>\n","protected":false},"author":84,"featured_media":0,"comment_status":"open","ping_status":"closed","sticky":false,"template":"","format":"standard","meta":[],"categories":[2],"tags":[],"_links":{"self":[{"href":"https:\/\/www.ultrasaurus.com\/wp-json\/wp\/v2\/posts\/391"}],"collection":[{"href":"https:\/\/www.ultrasaurus.com\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/www.ultrasaurus.com\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/www.ultrasaurus.com\/wp-json\/wp\/v2\/users\/84"}],"replies":[{"embeddable":true,"href":"https:\/\/www.ultrasaurus.com\/wp-json\/wp\/v2\/comments?post=391"}],"version-history":[{"count":0,"href":"https:\/\/www.ultrasaurus.com\/wp-json\/wp\/v2\/posts\/391\/revisions"}],"wp:attachment":[{"href":"https:\/\/www.ultrasaurus.com\/wp-json\/wp\/v2\/media?parent=391"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/www.ultrasaurus.com\/wp-json\/wp\/v2\/categories?post=391"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/www.ultrasaurus.com\/wp-json\/wp\/v2\/tags?post=391"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}